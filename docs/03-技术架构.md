# ğŸ—ï¸ ç²¾çµ1å· - æŠ€æœ¯æ¶æ„

> åŸºäº Moltbot å»¶ä¼¸ï¼Œä¸é‡å¤é€ è½®å­

---

## ä¸€ã€æ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·å±‚                                   â”‚
â”‚                                                                 â”‚
â”‚    ğŸ“± é£ä¹¦        ğŸŒ Webæ§åˆ¶å°        (æœªæ¥: ä¼ä¸šå¾®ä¿¡/é’‰é’‰)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç²¾çµ1å·ç½‘å…³å±‚                                â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ é£ä¹¦é€šé“    â”‚  â”‚  å®‰å…¨ç¡®è®¤   â”‚  â”‚  å‡­è¯ç®¡ç†   â”‚             â”‚
â”‚  â”‚ (æˆ‘ä»¬å¼€å‘)  â”‚  â”‚  (æˆ‘ä»¬å¼€å‘)  â”‚  â”‚ (æˆ‘ä»¬å¼€å‘)  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Moltbot æ ¸å¿ƒå±‚                              â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  æµè§ˆå™¨æ§åˆ¶  â”‚  â”‚  Shellæ‰§è¡Œ  â”‚  â”‚   AIè°ƒç”¨    â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Agentç³»ç»Ÿ  â”‚  â”‚  Skillsç³»ç»Ÿ  â”‚  â”‚  è®°å¿†ç³»ç»Ÿ   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       æ‰§è¡Œå±‚                                     â”‚
â”‚                                                                 â”‚
â”‚    ğŸŒ ç½‘é¡µ        ğŸ–¥ï¸ æœåŠ¡å™¨        ğŸ“± å„ç§æœåŠ¡API                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€ä¸é‡å¤é€ è½®å­

### Moltbot å·²æœ‰ï¼ˆç›´æ¥ç”¨ï¼‰

| èƒ½åŠ› | Moltbot æ¨¡å— | è¯´æ˜ |
|------|-------------|------|
| æµè§ˆå™¨æ§åˆ¶ | `browser/` | Playwright å°è£… |
| Shell æ‰§è¡Œ | `shell/` | å‘½ä»¤æ‰§è¡Œ |
| AI è°ƒç”¨ | `agents/` | å¤šæ¨¡å‹æ”¯æŒ |
| Agent ç³»ç»Ÿ | `agents/` | Agent åˆ›å»ºå’Œç®¡ç† |
| Skills ç³»ç»Ÿ | `skills/` | å¯æ‰©å±•æŠ€èƒ½ |
| Hooks ç³»ç»Ÿ | `hooks/` | äº‹ä»¶é’©å­ |
| è®°å¿†ç³»ç»Ÿ | `memory/` | å‘é‡è®°å¿† |

### æˆ‘ä»¬éœ€è¦å¼€å‘

| èƒ½åŠ› | è¯´æ˜ | å·¥ä½œé‡ |
|------|------|--------|
| é£ä¹¦é€šé“ | æ¥å…¥é£ä¹¦æ¶ˆæ¯ | 3-5 å¤© |
| å®‰å…¨ç¡®è®¤ | æ•æ„Ÿæ“ä½œç¡®è®¤æœºåˆ¶ | 2-3 å¤©ï¼ˆå·²æœ‰åŸºç¡€ï¼‰|
| å‡­è¯ç®¡ç† | ç”¨æˆ·æˆæƒå‡­è¯å­˜å‚¨ | 2-3 å¤© |
| ç²¾çµçµé­‚ | System Prompt + äººæ ¼ | 1-2 å¤© |

---

## ä¸‰ã€é¡¹ç›®ç»“æ„

```
spirit-one/
â”‚
â”œâ”€â”€ src/                        # ç½‘å…³å…¥å£
â”‚   â”œâ”€â”€ index.ts                # ä¸»å…¥å£
â”‚   â”œâ”€â”€ security/               # å®‰å…¨æ¨¡å—ï¼ˆå·²å®Œæˆï¼‰
â”‚   â”‚   â”œâ”€â”€ sensitive-operations.ts
â”‚   â”‚   â”œâ”€â”€ feishu-confirm.ts
â”‚   â”‚   â””â”€â”€ secure-executor.ts
â”‚   â””â”€â”€ memory/                 # è®°å¿†æ‰©å±•
â”‚       â””â”€â”€ hybrid-memory.ts
â”‚
â”œâ”€â”€ plugins/                    # ç²¾çµ1å·æ’ä»¶ï¼ˆéœ€è¦å¼€å‘ï¼‰
â”‚   â”œâ”€â”€ feishu-channel/         # é£ä¹¦é€šé“æ’ä»¶
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ message-handler.ts
â”‚   â”‚   â”œâ”€â”€ card-builder.ts
â”‚   â”‚   â””â”€â”€ callback-handler.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ credentials/            # å‡­è¯ç®¡ç†æ’ä»¶
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ storage.ts          # åŠ å¯†å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ cookie-manager.ts   # Cookie ç®¡ç†
â”‚   â”‚   â””â”€â”€ api-key-manager.ts  # API Key ç®¡ç†
â”‚   â”‚
â”‚   â””â”€â”€ security-confirm/       # å®‰å…¨ç¡®è®¤æ’ä»¶
â”‚       â”œâ”€â”€ index.ts
â”‚       â””â”€â”€ hooks.ts            # Moltbot Hooks é›†æˆ
â”‚
â”œâ”€â”€ soul-bridge/                # ç²¾çµçµé­‚
â”‚   â”œâ”€â”€ SOUL.md                 # äººæ ¼å®šä¹‰
â”‚   â”œâ”€â”€ AGENTS.md               # Agent è¡Œä¸ºå‡†åˆ™
â”‚   â””â”€â”€ system-prompt.ts        # System Prompt ç”Ÿæˆ
â”‚
â”œâ”€â”€ libs/                       # ç¬¬ä¸‰æ–¹åº“
â”‚   â””â”€â”€ moltbot/                # Moltbot æ ¸å¿ƒï¼ˆä¸ä¿®æ”¹ï¼‰
â”‚       â””â”€â”€ dist/               # ç¼–è¯‘åçš„æ–‡ä»¶
â”‚
â”œâ”€â”€ core/                       # ç²¾çµæ ¸å¿ƒé€»è¾‘
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ ai.ts               # AI æ¨ç†
â”‚       â”œâ”€â”€ knowledge-graph.ts  # çŸ¥è¯†å›¾è°±
â”‚       â””â”€â”€ memory-pyramid.ts   # è®°å¿†ç³»ç»Ÿ
â”‚
â”œâ”€â”€ docs/                       # æ–‡æ¡£
â”‚   â”œâ”€â”€ 01-æ„¿æ™¯ä¸å®šä½.md
â”‚   â”œâ”€â”€ 02-æ ¸å¿ƒèƒ½åŠ›è®¾è®¡.md
â”‚   â”œâ”€â”€ 03-æŠ€æœ¯æ¶æ„.md
â”‚   â”œâ”€â”€ 04-äº§å“å½¢æ€.md
â”‚   â””â”€â”€ 05-å¼€å‘è·¯çº¿å›¾.md
â”‚
â”œâ”€â”€ .env                        # ç¯å¢ƒå˜é‡
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

---

## å››ã€é£ä¹¦é€šé“æ’ä»¶è®¾è®¡

### æ¶ˆæ¯å¤„ç†æµç¨‹

```
é£ä¹¦æ¶ˆæ¯ â†’ ç½‘å…³æ¥æ”¶ â†’ è§£æ â†’ è½¬å‘ç»™ Moltbot â†’ æ‰§è¡Œ â†’ è¿”å›ç»“æœ â†’ é£ä¹¦å›å¤
```

### æ ¸å¿ƒä»£ç ç»“æ„

```typescript
// plugins/feishu-channel/index.ts
import { ChannelPlugin } from '../../types';
import { handleMessage } from './message-handler';
import { handleCardCallback } from './callback-handler';

export const feishuChannel: ChannelPlugin = {
  name: 'feishu',
  
  // åˆå§‹åŒ–
  async init(config) {
    // è®¾ç½®é£ä¹¦ App é…ç½®
  },
  
  // å¤„ç†æ”¶åˆ°çš„æ¶ˆæ¯
  async onMessage(event) {
    return handleMessage(event);
  },
  
  // å¤„ç†å¡ç‰‡å›è°ƒ
  async onCardCallback(event) {
    return handleCardCallback(event);
  },
  
  // å‘é€æ¶ˆæ¯
  async sendMessage(chatId, content) {
    // è°ƒç”¨é£ä¹¦ API
  },
  
  // å‘é€å¡ç‰‡
  async sendCard(chatId, card) {
    // è°ƒç”¨é£ä¹¦ API
  }
};
```

### æ¶ˆæ¯ç±»å‹æ”¯æŒ

| ç±»å‹ | æ¥æ”¶ | å‘é€ |
|------|------|------|
| æ–‡æœ¬æ¶ˆæ¯ | âœ… | âœ… |
| å›¾ç‰‡æ¶ˆæ¯ | âœ… | âœ… |
| äº¤äº’å¡ç‰‡ | - | âœ… |
| å¡ç‰‡å›è°ƒ | âœ… | - |
| æ–‡ä»¶ | âœ… | âœ… |

---

## äº”ã€å®‰å…¨ç¡®è®¤é›†æˆ

### ä¸ Moltbot Hooks é›†æˆ

```typescript
// plugins/security-confirm/hooks.ts
import { registerHook } from 'moltbot';
import { requestConfirmation, isKillSwitchActive } from './feishu-confirm';

// æ³¨å†Œåˆ° Moltbot çš„ Hook ç³»ç»Ÿ
registerHook('before:browser:action', async (action, context) => {
  // æ£€æŸ¥æ˜¯å¦éœ€è¦ç¡®è®¤
  if (isSensitiveAction(action)) {
    const approved = await requestConfirmation({
      type: action.type,
      description: action.description,
      chatId: context.chatId,
    });
    
    if (!approved) {
      throw new Error('ç”¨æˆ·æœªæˆæƒæ­¤æ“ä½œ');
    }
  }
});

registerHook('before:shell:exec', async (command, context) => {
  // Shell å‘½ä»¤ç¡®è®¤
  if (isDangerousCommand(command)) {
    const approved = await requestConfirmation({
      type: 'shell_command',
      command: command,
      chatId: context.chatId,
    });
    
    if (!approved) {
      throw new Error('ç”¨æˆ·æœªæˆæƒæ­¤æ“ä½œ');
    }
  }
});
```

---

## å…­ã€å‡­è¯ç®¡ç†è®¾è®¡

### å­˜å‚¨ç»“æ„

```typescript
interface UserCredentials {
  userId: string;
  
  // AI æ¨¡å‹ API Key
  aiModels: {
    openai?: { apiKey: string; encrypted: true };
    claude?: { apiKey: string; encrypted: true };
    // ...
  };
  
  // ç½‘ç«™ç™»å½•æ€
  websites: {
    [domain: string]: {
      cookies: Cookie[];
      savedAt: Date;
      expiresAt?: Date;
    };
  };
  
  // æœåŠ¡å™¨ SSH
  servers: {
    [name: string]: {
      host: string;
      port: number;
      username: string;
      privateKey: string; // encrypted
    };
  };
}
```

### å®‰å…¨æªæ–½

```
1. åŠ å¯†å­˜å‚¨
   - ä½¿ç”¨ AES-256 åŠ å¯†æ•æ„Ÿæ•°æ®
   - å¯†é’¥ç”±ç”¨æˆ·ä¸»å¯†ç æ´¾ç”Ÿ

2. éš”ç¦»å­˜å‚¨
   - æ¯ä¸ªç”¨æˆ·ç‹¬ç«‹å­˜å‚¨ç©ºé—´
   - ä¸åŒæœåŠ¡çš„å‡­è¯ç›¸äº’éš”ç¦»

3. è®¿é—®æ§åˆ¶
   - åªåœ¨æ‰§è¡Œæ—¶è§£å¯†ä½¿ç”¨
   - ç”¨å®Œç«‹å³æ¸…é™¤å†…å­˜

4. ç”¨æˆ·æ§åˆ¶
   - ç”¨æˆ·å¯æŸ¥çœ‹å·²æˆæƒçš„æœåŠ¡
   - ç”¨æˆ·å¯éšæ—¶æ’¤é”€æˆæƒ
```

---

## ä¸ƒã€æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ |
|------|------|
| è¿è¡Œæ—¶ | Node.js 20+ |
| è¯­è¨€ | TypeScript |
| æ ¸å¿ƒæ¡†æ¶ | Moltbot |
| æµè§ˆå™¨è‡ªåŠ¨åŒ– | Playwright |
| AI è°ƒç”¨ | OpenAI SDK / å„æ¨¡å‹ SDK |
| é£ä¹¦ API | é£ä¹¦å¼€æ”¾å¹³å° SDK |
| æ•°æ®å­˜å‚¨ | SQLite / Supabase |
| åŠ å¯† | crypto (Node.js å†…ç½®) |

---

## å…«ã€éƒ¨ç½²æ¶æ„

### MVP é˜¶æ®µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           äº‘æœåŠ¡å™¨                   â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      ç²¾çµ1å·æœåŠ¡             â”‚   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â”‚  - é£ä¹¦ç½‘å…³                 â”‚   â”‚
â”‚  â”‚  - Moltbot æ ¸å¿ƒ             â”‚   â”‚
â”‚  â”‚  - æµè§ˆå™¨ï¼ˆPlaywrightï¼‰      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      æ•°æ®å­˜å‚¨               â”‚   â”‚
â”‚  â”‚  - SQLite / Supabase        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
     é£ä¹¦å¼€æ”¾å¹³å°
          â”‚
          â–¼
       ç”¨æˆ·æ‰‹æœº
```

### ç”Ÿäº§é˜¶æ®µï¼ˆå¯é€‰ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API ç½‘å…³      â”‚â”€â”€â”€â”€â–¶â”‚   ç²¾çµæœåŠ¡é›†ç¾¤   â”‚
â”‚  (è´Ÿè½½å‡è¡¡)      â”‚     â”‚  (å¤šå®ä¾‹)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚    æ•°æ®åº“       â”‚
                        â”‚  (PostgreSQL)   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

*ä¸‹ä¸€ç¯‡ï¼š[04-äº§å“å½¢æ€](./04-äº§å“å½¢æ€.md)*
