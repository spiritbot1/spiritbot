# 🚀 精灵1号 - 开发路线图

> 2 周 MVP，渐进式迭代

---

## 一、总体规划

```
第1周：飞书通道 + 基础对话
    │
    ▼
第2周：安全确认 + 凭证管理 + MVP 完成
    │
    ▼
第3-4周：Web 控制台 + 能力扩展
    │
    ▼
后续：更多通道 + 高级功能
```

---

## 二、第一阶段：MVP（2周）

### Week 1：飞书通道 + 基础对话

| 天数 | 任务 | 产出 |
|------|------|------|
| Day 1 | 研究 Moltbot 通道插件结构 | 理解插件机制 |
| Day 2 | 飞书 API 对接基础 | 消息收发能力 |
| Day 3 | 飞书通道插件开发 | 基础插件框架 |
| Day 4 | 消息处理逻辑 | 文本消息处理 |
| Day 5 | 与 Moltbot Agent 集成 | AI 对话能力 |
| Day 6-7 | 测试 + 修复 | 基础对话可用 |

**Week 1 交付物：**
- ✅ 飞书机器人可以收发消息
- ✅ 可以调用 AI 进行对话
- ✅ 基础浏览器控制可用

### Week 2：安全确认 + 凭证管理

| 天数 | 任务 | 产出 |
|------|------|------|
| Day 1 | 安全确认系统集成到 Moltbot Hooks | 敏感操作拦截 |
| Day 2 | 飞书确认卡片开发 | 交互卡片 |
| Day 3 | 凭证管理基础 | 加密存储 |
| Day 4 | Cookie 管理（网站登录态）| 登录态保存 |
| Day 5 | 精灵人格注入 | System Prompt |
| Day 6-7 | 整体联调 + 测试 | MVP 完成 |

**Week 2 交付物：**
- ✅ 敏感操作需确认
- ✅ 一键终止功能
- ✅ 网站登录态管理
- ✅ 精灵人格（有灵魂的对话）

---

## 三、第二阶段：完善（2周）

### Week 3：Web 控制台

| 任务 | 说明 |
|------|------|
| 控制台前端框架 | React + TailwindCSS |
| 飞书 OAuth 登录 | 用户认证 |
| 授权管理页面 | 查看/添加/删除授权 |
| 任务历史页面 | 查看执行记录 |

### Week 4：能力扩展

| 任务 | 说明 |
|------|------|
| 服务器 SSH 管理 | 支持 SSH 连接 |
| 任务分解优化 | 更智能的任务拆解 |
| 记忆系统增强 | 记住用户偏好 |
| 常用场景优化 | 提升体验 |

---

## 四、第三阶段：扩展（持续）

| 功能 | 优先级 | 说明 |
|------|--------|------|
| 企业微信通道 | 高 | 第二个通道 |
| 钉钉通道 | 中 | 第三个通道 |
| Agent 创建能力 | 中 | 动态创建 Agent |
| 工作流编辑器 | 中 | 可视化编排 |
| 3D 形象 | 低 | 锦上添花 |
| 桌面端 | 低 | 完整体验 |

---

## 五、详细任务清单

### 5.1 飞书通道插件

```
plugins/feishu-channel/
├── index.ts              # 插件入口
├── config.ts             # 配置管理
├── api/
│   ├── auth.ts           # 获取 access_token
│   ├── message.ts        # 消息 API
│   └── card.ts           # 卡片 API
├── handlers/
│   ├── message.ts        # 消息处理
│   ├── event.ts          # 事件处理
│   └── callback.ts       # 卡片回调
├── cards/
│   ├── confirm.ts        # 确认卡片
│   ├── status.ts         # 状态卡片
│   ├── progress.ts       # 进度卡片
│   └── result.ts         # 结果卡片
└── utils/
    ├── decrypt.ts        # 消息解密
    └── verify.ts         # 签名验证
```

### 5.2 安全确认集成

```
plugins/security-confirm/
├── index.ts              # 插件入口
├── hooks.ts              # Moltbot Hooks 注册
├── detector.ts           # 敏感操作检测
├── confirm.ts            # 确认逻辑
└── kill-switch.ts        # 终止开关
```

### 5.3 凭证管理

```
plugins/credentials/
├── index.ts              # 插件入口
├── storage.ts            # 加密存储
├── managers/
│   ├── api-key.ts        # API Key 管理
│   ├── cookie.ts         # Cookie 管理
│   └── ssh.ts            # SSH 密钥管理
└── crypto.ts             # 加密工具
```

---

## 六、里程碑

### M1：能对话（Week 1 结束）

```
✅ 在飞书和精灵1号对话
✅ 精灵能调用 AI 回复
✅ 精灵能执行简单浏览器操作
```

### M2：能干活（Week 2 结束）

```
✅ 精灵能执行复杂任务
✅ 敏感操作需确认
✅ 可以保存网站登录态
✅ 有精灵的人格和灵魂
```

### M3：能管理（Week 4 结束）

```
✅ Web 控制台可用
✅ 可以管理授权
✅ 可以查看任务历史
✅ 支持 SSH 运维
```

### M4：能扩展（持续）

```
✅ 更多通道（企微、钉钉）
✅ 更多能力
✅ 更好的体验
```

---

## 七、技术债务

开发过程中可能产生的技术债务，后期需要处理：

| 债务 | 影响 | 处理时机 |
|------|------|---------|
| 错误处理不完善 | 异常情况处理 | M2 后 |
| 日志不够详细 | 问题排查困难 | M2 后 |
| 测试覆盖不足 | 质量风险 | M3 后 |
| 性能未优化 | 响应慢 | M4 后 |

---

## 八、风险与应对

| 风险 | 概率 | 影响 | 应对 |
|------|------|------|------|
| 飞书 API 变更 | 低 | 中 | 关注官方文档 |
| Moltbot 兼容问题 | 中 | 高 | 锁定版本，做好适配 |
| 性能瓶颈 | 中 | 中 | 优化 + 扩容 |
| 安全漏洞 | 低 | 高 | 代码审查 + 测试 |

---

## 九、下一步行动

立即开始 **Week 1 Day 1** 的任务：

```
1. 研究 Moltbot 通道插件结构
   - 阅读 Telegram/Discord 插件源码
   - 理解插件注册机制
   - 理解消息处理流程

2. 创建飞书通道插件骨架
   - 创建目录结构
   - 编写基础代码框架
```

---

**准备好了吗？开始吧！** 🚀
